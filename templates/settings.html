{# settings.html #}
{# Version: 1.2.5 #}
{# Note: Added {{ form.csrf_token }} to settings form to prevent CSRF errors. Maintained settings display from version 1.2.4. Ensured compatibility with app.py (1.2.36), incentive_service.py (1.2.9), config.py (1.2.6), forms.py (1.2.2), incentive.html (1.2.17), admin_manage.html (1.2.17), quick_adjust.html (1.2.8), script.js (1.2.28), style.css (1.2.11), base.html (1.2.11), macros.html (1.2.5), start_voting.html (1.2.4). No changes to core functionality (settings management). #}

{% extends "base.html" %}
{% import "macros.html" as macros %}
{% block content %}
<div class="container">
    <h1>Settings</h1>
    {% if is_master %}
    <form id="settingsForm" method="POST" action="{{ url_for('admin_settings') }}">
        {{ form.csrf_token }}
        {{ macros.render_field(name='key', id='settings_key', label_text='Setting Key', class='form-control', required=True) }}
        {{ macros.render_field(name='value', id='settings_value', label_text='Value', class='form-control', required=True) }}
        {{ macros.render_submit_button('Update Setting') }}
    </form>
    <h2>Current Settings</h2>
    <table class="table">
        <thead>
            <tr>
                <th>Key</th>
                <th>Value</th>
            </tr>
        </thead>
        <tbody>
            {% for key, value in settings.items() %}
            <tr>
                <td>{{ key }}</td>
                <td>{{ value }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>Access restricted to master admin.</p>
    {% endif %}
    {% if get_flashed_messages() %}
        {% for category, message in get_flashed_messages(with_categories=true) %}
            <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
    {% endif %}
</div>
{% endblock %}