{% extends "base.html" %}
{% import "macros.html" as macros %}
{# minigames.html #}
{# Enhanced Vegas Casino Minigames #}

{% block head %}
<link href="{{ url_for('static', filename='minigames.css') }}?v={{ import_time }}" rel="stylesheet">
<link href="{{ url_for('static', filename='css/phaser-casino.css') }}?v={{ import_time }}" rel="stylesheet">
{% endblock %}

{% block content %}
<div class="vegas-wrapper">
    <!-- Casino Minigames Header -->
    <div class="casino-header">
        <div class="casino-title">
            <h1>üé∞ VEGAS CASINO MINIGAMES üé∞</h1>
            <p class="casino-subtitle">Try Your Luck & Win Big!</p>
        </div>
        
        <div class="player-stats">
            <div class="stat-item">
                <span class="stat-label">Your Points:</span>
                <span class="stat-value" id="playerPoints">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Games Played:</span>
                <span class="stat-value" id="gamesPlayed">0</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total Winnings:</span>
                <span class="stat-value" id="totalWinnings">$0</span>
            </div>
        </div>
    </div>

    <!-- Progressive Jackpot Display -->
    <div class="progressive-jackpot">
        <div class="jackpot-label">üèÜ PROGRESSIVE JACKPOT üèÜ</div>
        <div class="jackpot-amount" id="progressiveJackpot">$500.00</div>
        <div class="jackpot-timer">Next Drop In: <span id="jackpotTimer">--:--</span></div>
    </div>

    <!-- Phaser.js Enhanced Mode Toggle -->
    <div class="game-mode-selector">
        <label class="mode-switch">
            <input type="checkbox" id="phaserModeToggle" checked>
            <span class="mode-slider"></span>
            <span class="mode-label">Enhanced Graphics Mode</span>
        </label>
    </div>

    <!-- Game Selection -->
    <div class="games-grid phaser-game-grid">
        <!-- Fortune Wheel -->
        <div class="game-card phaser-game-card" id="fortuneWheelCard">
            <div class="game-header">
                <h3>üé° Fortune Wheel</h3>
                <span class="game-status">PHASER ENHANCED!</span>
            </div>
            <div class="game-description">
                Physics-based wheel spinning with dynamic lighting effects! Win up to $100 or hit the JACKPOT!
            </div>
            <div class="game-stats">
                <span>Win Rate: 75%</span>
                <span>Max Prize: JACKPOT</span>
            </div>
            <button class="play-game-btn phaser-game-launcher" data-phaser="true" data-game="wheel">
                üé∞ SPIN NOW IN 3D!
            </button>
        </div>

        <!-- Enhanced Dice -->
        <div class="game-card phaser-game-card" id="diceCard">
            <div class="game-header">
                <h3>üé≤ 3D Dice Roll</h3>
                <span class="game-status">PHYSICS ENGINE!</span>
            </div>
            <div class="game-description">
                Roll dice with realistic Matter.js physics! Snake Eyes pays $100!
            </div>
            <div class="game-stats">
                <span>Win Rate: 28%</span>
                <span>Max Prize: $100</span>
            </div>
            <button class="play-game-btn phaser-game-launcher" data-phaser="true" data-game="dice">
                üé≤ ROLL WITH PHYSICS!
            </button>
        </div>

        <!-- Enhanced Slots -->
        <div class="game-card phaser-game-card" id="slotsCard">
            <div class="game-header">
                <h3>üé∞ Vegas Slots</h3>
                <span class="game-status">ANIMATED REELS!</span>
            </div>
            <div class="game-description">
                Smooth reel animations with particle effects and cascading wins!
            </div>
            <div class="game-stats">
                <span>Win Rate: 35%</span>
                <span>Max Prize: $75</span>
            </div>
            <button class="play-game-btn phaser-game-launcher" data-phaser="true" data-game="slots">
                üé∞ SPIN ENHANCED REELS!
            </button>
        </div>

        <!-- Scratch Cards -->
        <div class="game-card phaser-game-card" id="scratchCardGame">
            <div class="game-header">
                <h3>üéüÔ∏è Scratch Cards</h3>
                <span class="game-status">INTERACTIVE!</span>
            </div>
            <div class="game-description">
                Interactive scratch mechanics with smooth reveal animations!
            </div>
            <div class="game-stats">
                <span>Win Rate: 40%</span>
                <span>Max Prize: $50</span>
            </div>
            <button class="play-game-btn phaser-game-launcher" data-phaser="true" data-game="scratch">
                üéüÔ∏è SCRATCH TO WIN!
            </button>
        </div>
    </div>

    <!-- Game Area -->
    <div class="game-area" id="gameArea" style="display: none;">
        <div class="game-controls">
            <button class="back-btn" onclick="showGameSelection()">
                ‚Üê Back to Games
            </button>
            <h2 id="currentGameTitle">Select a Game</h2>
            <div class="game-info">
                <span id="gameInstructions">Choose a game to get started!</span>
            </div>
        </div>

        <!-- Game Containers -->
        <div id="fortune-wheel-container" class="game-container" style="display: none;"></div>
        <div id="enhanced-dice-container" class="game-container" style="display: none;"></div>
        <div id="vegas-slots-container" class="game-container" style="display: none;">
            <div class="slot-machine-enhanced">
                <div class="slot-display">
                    <div class="reel" id="reel1">üçí</div>
                    <div class="reel" id="reel2">üçã</div>
                    <div class="reel" id="reel3">‚≠ê</div>
                </div>
                <button class="spin-button" onclick="spinSlots()">
                    üé∞ SPIN THE REELS! üé∞
                </button>
                <div class="slot-stats">
                    <div>Last Win: <span id="lastSlotWin">-</span></div>
                    <div>Spins: <span id="totalSpins">0</span></div>
                </div>
            </div>
        </div>
        <div id="scratch-cards-container" class="game-container" style="display: none;">
            <div class="scratch-card-game">
                <div class="scratch-card" id="scratchCard">
                    <div class="scratch-surface">Scratch Here!</div>
                    <div class="hidden-prize">$25</div>
                </div>
                <button class="new-card-btn" onclick="newScratchCard()">
                    üéüÔ∏è NEW CARD üéüÔ∏è
                </button>
            </div>
        </div>
    </div>

    <!-- Recent Wins Feed -->
    <div class="recent-wins" id="recentWins">
        <h3>üèÜ Recent Big Wins üèÜ</h3>
        <div class="wins-feed" id="winsFeed">
            <div class="win-item">
                <span class="winner">System</span> won <span class="amount">$100</span> on <span class="game">Fortune Wheel</span>!
            </div>
        </div>
    </div>

    <!-- Daily Challenges -->
    <div class="daily-challenges">
        <h3>üéØ Daily Challenges</h3>
        <div class="challenges-list">
            <div class="challenge-item">
                <div class="challenge-text">Play 3 different games</div>
                <div class="challenge-progress">Progress: <span id="gamesProgress">0/3</span></div>
                <div class="challenge-reward">Reward: +15 points</div>
            </div>
            <div class="challenge-item">
                <div class="challenge-text">Win 5 times in any game</div>
                <div class="challenge-progress">Progress: <span id="winsProgress">0/5</span></div>
                <div class="challenge-reward">Reward: +25 points</div>
            </div>
            <div class="challenge-item">
                <div class="challenge-text">Hit a winning streak of 3</div>
                <div class="challenge-progress">Progress: <span id="streakProgress">0/3</span></div>
                <div class="challenge-reward">Reward: +30 points</div>
            </div>
        </div>
    </div>
</div>

<!-- Phaser.js Container (will be created dynamically) -->
<div id="phaser-game-container" style="display: none;"></div>

<!-- Game Scripts -->
<!-- Phaser.js Library (loaded from CDN or npm) -->
<script src="https://cdn.jsdelivr.net/npm/phaser@3.70.0/dist/phaser.min.js"></script>

<!-- Phaser Casino Engine -->
<script src="{{ url_for('static', filename='js/phaser-casino.js') }}?v={{ import_time }}"></script>

<!-- Integration Layer -->
<script src="{{ url_for('static', filename='js/phaser-integration.js') }}?v={{ import_time }}"></script>

<!-- Legacy Game Scripts (fallback) -->
<script src="{{ url_for('static', filename='fortune-wheel.js') }}?v={{ import_time }}"></script>
<script src="{{ url_for('static', filename='enhanced-dice.js') }}?v={{ import_time }}"></script>
<script src="{{ url_for('static', filename='minigames-controller.js') }}?v={{ import_time }}"></script>

<script>
    // Initialize Phaser mode toggle
    document.addEventListener('DOMContentLoaded', function() {
        const toggle = document.getElementById('phaserModeToggle');
        if (toggle && window.phaserIntegration) {
            toggle.addEventListener('change', function() {
                window.phaserIntegration.setConfig({
                    enablePhaser: this.checked,
                    fallbackToLegacy: true
                });
                
                // Update UI to reflect mode
                const cards = document.querySelectorAll('.game-card');
                cards.forEach(card => {
                    const status = card.querySelector('.game-status');
                    if (status) {
                        if (this.checked) {
                            status.textContent = status.dataset.phaserText || 'ENHANCED!';
                        } else {
                            status.textContent = status.dataset.legacyText || 'CLASSIC';
                        }
                    }
                });
            });
        }
    });
</script>

{% endblock %}