{% macro render_field(field, id, label_text, class='', type='text', required=False, value='') %}
    <div class="mb-3">
        <label for="{{ id }}" class="form-label">{{ label_text }}</label>
        {% if type == 'textarea' %}
            <textarea id="{{ id }}" name="{{ field.name }}" class="{{ class }}" {% if required %}required{% endif %}>{{ value }}</textarea>
        {% else %}
            <input type="{{ type }}" id="{{ id }}" name="{{ field.name }}" class="{{ class }}" value="{{ value }}" {% if required %}required{% endif %}>
        {% endif %}
        {% if field.errors %}
            <div class="invalid-feedback d-block">
                {% for error in field.errors %}
                    {{ error }}<br>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_select_field(field, id, label_text, options, selected_value='', class='form-control') %}
    <div class="mb-3">
        <label for="{{ id }}" class="form-label">{{ label_text }}</label>
        <select id="{{ id }}" name="{{ field.name }}" class="{{ class }}">
            {% for value, text in options %}
                <option value="{{ value }}" {% if value == selected_value %}selected{% endif %}>{{ text }}</option>
            {% endfor %}
        </select>
        {% if field.errors %}
            <div class="invalid-feedback d-block">
                {% for error in field.errors %}
                    {{ error }}<br>
                {% endfor %}
            </div>
        {% endif %}
    </div>
{% endmacro %}

{% macro render_checkboxes(name, id, options, selected_values=[], class='form-check-input') %}
    <div class="mb-3 checkbox-container">
        <label for="{{ id }}" class="form-label">Days to Trigger</label>
        <div class="d-flex flex-wrap" id="{{ id }}" data-selected="{{ selected_values|tojson }}">
            {% for value, text in options %}
                <div class="form-check me-3">
                    <input type="checkbox" name="{{ name }}" id="{{ id }}_{{ value }}" value="{{ value }}" class="{{ class }}" {% if value in selected_values %}checked{% endif %}>
                    <label class="form-check-label" for="{{ id }}_{{ value }}">{{ text }}</label>
                </div>
            {% endfor %}
        </div>
    </div>
{% endmacro %}

{% macro render_submit_button(text, id='', class='') %}
    <button type="submit" {% if id %}id="{{ id }}"{% endif %} class="btn {{ class }}">{{ text }}</button>
{% endmacro %}

{% macro render_csrf_token(id='csrf_token') %}
    <input type="hidden" id="{{ id }}" name="csrf_token" value="{{ csrf_token() }}">
{% endmacro %}

{% macro render_rule_list(items, type, edit_endpoint, remove_endpoint, edit_form=None) %}
    <div class="{{ type }}-container">
        <ul class="list-unstyled">
            {% for item in items %}
                <li>
                    <span>
                        {{ item.description if type == 'rule' else item.role_name }} 
                        ({{ item.points if type == 'rule' else item.percentage }}%)
                        {% if item.details %}
                            <span class="tooltip-text" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ item.details }}">?</span>
                        {% endif %}
                    </span>
                    <form action="{{ url_for(edit_endpoint) }}" method="POST" class="d-inline">
                        {{ render_csrf_token(id=type + '_edit_csrf_token_' + loop.index|string) }}
                        {% if type == 'rule' and edit_form %}
                            <input type="hidden" name="old_description" value="{{ item.description }}">
                            <input type="text" name="new_description" value="{{ item.description }}" class="form-control d-inline-block w-auto" required>
                            <input type="number" name="points" value="{{ item.points }}" class="form-control d-inline-block w-auto" required>
                            <textarea name="details" class="form-control d-inline-block w-auto">{{ item.details or '' }}</textarea>
                            <button type="submit" class="btn btn-primary btn-sm">Edit</button>
                        {% else %}
                            <input type="hidden" name="{{ 'description' if type == 'rule' else 'old_role_name' }}" value="{{ item.description if type == 'rule' else item.role_name }}">
                            <input type="text" name="{{ 'new_description' if type == 'rule' else 'new_role_name' }}" value="{{ item.description if type == 'rule' else item.role_name }}" class="form-control d-inline-block w-auto" required>
                            <input type="number" name="percentage" value="{{ item.percentage }}" class="form-control d-inline-block w-auto" required>
                            <button type="submit" class="btn btn-primary btn-sm">Edit</button>
                        {% endif %}
                    </form>
                    <form action="{{ url_for(remove_endpoint) }}" method="POST" class="d-inline">
                        {{ render_csrf_token(id=type + '_remove_csrf_token_' + loop.index|string) }}
                        <input type="hidden" name="{{ 'description' if type == 'rule' else 'role_name' }}" value="{{ item.description if type == 'rule' else item.role_name }}">
                        <button type="submit" class="btn btn-danger btn-sm">Remove</button>
                    </form>
                </li>
            {% endfor %}
        </ul>
    </div>
{% endmacro %}

{% macro render_voting_results(results, is_admin=False) %}
    <table class="table table-striped">
        <thead>
            <tr>
                {% if is_admin %}
                    <th>Voter Initials</th>
                    <th>Recipient</th>
                    <th>Vote</th>
                    <th>Date</th>
                    <th>Points</th>
                {% else %}
                    <th>Week</th>
                    <th>Recipient</th>
                    <th>Plus Votes</th>
                    <th>Minus Votes</th>
                    <th>Points</th>
                {% endif %}
            </tr>
        </thead>
        <tbody>
            {% for result in results %}
                <tr>
                    {% if is_admin %}
                        <td>{{ result.voter_initials }}</td>
                        <td>{{ result.recipient_name }}</td>
                        <td class="{% if result.vote_value > 0 %}vote-positive{% else %}vote-negative{% endif %}">{{ result.vote_value }}</td>
                        <td>{{ result.vote_date }}</td>
                        <td>{{ result.points }}</td>
                    {% else %}
                        <td>{{ result.week_number }}</td>
                        <td>{{ result.recipient_name }}</td>
                        <td>{{ result.plus_votes }}</td>
                        <td>{{ result.minus_votes }}</td>
                        <td>{{ result.points }}</td>
                    {% endif %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endmacro %}

{% macro render_feedback_table(feedback, type, read_endpoint) %}
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Comment</th>
                <th>Submitter</th>
                <th>Timestamp</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for item in feedback %}
                <tr>
                    <td>{{ item.comment }}</td>
                    <td>{{ item.submitter }}</td>
                    <td>{{ item.timestamp }}</td>
                    <td>{% if item.read %}Read{% else %}Unread{% endif %}</td>
                    <td>
                        {% if not item.read %}
                            <form action="{{ url_for(read_endpoint) }}" method="POST" class="d-inline">
                                {{ render_csrf_token(id=type + '_read_csrf_token_' + loop.index|string) }}
                                <input type="hidden" name="feedback_id" value="{{ item.id }}">
                                <button type="submit" class="btn btn-success btn-sm">Mark Read</button>
                            </form>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% endmacro %}