{% extends "base.html" %}
{% block title %}Incentive Program{% endblock %}
{% block content %}

    A1 Rent-It Incentive Program

    Total Incentive Pot: ${{ "%.2f"|format(pot_info.get('sales_dollars', 0) * pot_info.get('bonus_percent', 0) / 100) }}


    CSS Load Status: Checking...


    Scoreboard
<table id="scoreboard" class="table table-bordered">
    <thead>
        <tr>
            <th>Employee ID</th>
            <th>Name</th>
            <th>Score</th>
            <th>Role</th>
            <th>Share</th>
        </tr>
    </thead>
    <tbody>
        {% for emp in scoreboard %}
        <tr class="{{ get_score_class(emp.score) }}">
            <td>{{ emp.employee_id }}</td>
            <td>{{ emp.name }}</td>
            <td>{{ emp.score }}</td>
            <td>{{ emp.role }}</td>
            <td>${{ "%.2f"|format(0 if emp.score < 50 else (emp.score * pot_info.get(emp.role.lower() + '_point_value', 0))) }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

    Points Rules

    
        
            Positive Points

            

                {% for rule in rules|selectattr('points', 'ge', 0)|sort(attribute='description') %}
                	{{ rule.description }}: {{ rule.points }} points


                {% endfor %}
            
        

        
            Negative Points

            

                {% for rule in rules|selectattr('points', 'lt', 0)|sort(attribute='description') %}
                	{{ rule.description }}: {{ rule.points }} points


                {% endfor %}
            
        

    


    Incentive Pot

    
        
            Current Year

            Sales Dollars: ${{ "%.2f"|format(pot_info.get('sales_dollars', 0)) }}

            Bonus %: {{ pot_info.get('bonus_percent', 0) }}%

            Total Pot: ${{ "%.2f"|format(pot_info.get('sales_dollars', 0) * pot_info.get('bonus_percent', 0) / 100) }}

            {% for role in roles %}
            {{ role.role_name }} ({{ role.percentage }}%): ${{ "%.2f"|format(pot_info.get(role.role_name.lower() + '_pot', 0)) }}, Point Value: ${{ "%.2f"|format(pot_info.get(role.role_name.lower() + '_point_value', 0)) }}

            {% endfor %}
        

        
            Prior Year

            Prior Year Sales Dollars: ${{ "%.2f"|format(pot_info.get('prior_year_sales', 0)) }}

            Bonus %: {{ pot_info.get('bonus_percent', 0) }}%

            Total Pot: ${{ "%.2f"|format(pot_info.get('prior_year_sales', 0) * pot_info.get('bonus_percent', 0) / 100) }}

            {% for role in roles %}
            {{ role.role_name }} ({{ role.percentage }}%): ${{ "%.2f"|format(pot_info.get(role.role_name.lower() + '_prior_year_pot', 0)) }}, Point Value: ${{ "%.2f"|format(pot_info.get(role.role_name.lower() + '_prior_year_point_value', 0)) }}

            {% endfor %}
        

    


    {% if session.admin_id %}
    Start Voting
    {% if voting_active %}
    Pause Voting
    End Weekly Voting
    {% endif %}
    Manage Employees
    Logout
    {% endif %}
    View History

    {% if voting_active %}
    Cast Your Vote

    
        {{ vote_form.csrf_token }}
        
            {{ vote_form.initials.label }}
            {{ vote_form.initials(class="form-control") }}
        

        OK
    


    
        {{ vote_form.csrf_token }}
        	Employee ID	Name


                    {% if session.admin_id %}
                    	Initials
                    {% endif %}
                    	Role
                    	+1
                    	0
                    	-1
                
            
            

                {% for emp in scoreboard %}
                	{{ emp.employee_id }}	{{ emp.name }}

                    {% if session.admin_id %}
                    	{{ emp.initials }}
                    {% endif %}
                    	{{ emp.role }}
                    	
                    	
                    	
                
                {% endfor %}
            
        
        {{ vote_form.submit(class="btn btn-primary") }}
    

    {% endif %}

    {{ current_month }} Voting Results

    {% if not session.admin_id %}
    {% set weeks = voting_results | groupby('week_number') %}
    {% for week_num, week_results in weeks %}
    Week {{ week_num }}

    	Recipient Name	+1 Votes	-1 Votes	Points


            {% for result in week_results %}
            	{{ result.recipient_name }}	{{ result.plus_votes }}	{{ result.minus_votes }}	{{ result.points|default(0) }}


            {% endfor %}
        
    
    {% else %}
    No voting results for Week {{ week_num }}

    {% endfor %}
    {% else %}
    Voting results are available on the admin page for authorized users.

    {% endif %}




{% endblock %}