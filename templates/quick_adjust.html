{% extends "base.html" %}
{% import "macros.html" as macros %}
{# quick_adjust.html #}
{# Version: 1.2.13 #}
{# Note: Updated to support quick adjust for both logged-in admins (no auth fields) and non-logged-in users (with username/password fields). Added reason_options to fix TemplateSyntaxError. Compatible with app.py (1.2.94), incentive_service.py (1.2.24), config.py (1.2.6), forms.py (1.2.12), incentive.html (1.2.34), admin_manage.html (1.2.33), script.js (1.2.71), style.css (1.2.20), base.html (1.2.21), macros.html (1.2.10), start_voting.html (1.2.7), settings.html (1.2.6), admin_login.html (1.2.5), history.html (1.2.6), error.html, init_db.py (1.2.4). #}

{% block content %}
    <h2>Quick Adjust Points</h2>

    {% if get_flashed_messages() %}
        {% for category, message in get_flashed_messages(with_categories=true) %}
            <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                {{ message|safe }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endfor %}
    {% endif %}

    <div class="container">
        <form id="adjustPointsForm" action="{{ url_for('admin_quick_adjust_points') }}" method="POST">
            {{ macros.render_csrf_token(id='quick_adjust_csrf_token') }}
            {% if not is_admin %}
                {{ macros.render_field(name='username', id='quick_adjust_username', label_text='Username', class='form-control', required=True) }}
                {{ macros.render_field(name='password', id='quick_adjust_password', label_text='Password', class='form-control', type='password', required=True) }}
            {% endif %}
            {{ macros.render_select_field('employee_id', 'quick_adjust_employee_id', 'Employee', employee_options) }}
            {{ macros.render_field(name='points', id='quick_adjust_points', label_text='Points', class='form-control', type='number', required=True) }}
            {% set reason_options = [(r.description, r.description) for r in rules] + [('Other', 'Other')] %}
            {{ macros.render_select_field('reason', 'quick_adjust_reason', 'Reason', reason_options) }}
            {{ macros.render_field(name='notes', id='quick_adjust_notes', label_text='Notes (if Other)', class='form-control') }}
            {{ macros.render_submit_button('Adjust Points') }}
        </form>

        <div class="rules-container">
            <div class="rules-column">
                <h3>Positive Rules</h3>
                <ul>
                    {% for rule in rules if rule.points > 0 %}
                        <li>
                            <a href="#" class="rule-link quick-adjust-link" data-points="{{ rule.points }}" data-reason="{{ rule.description }}" data-employee="">
                                {{ rule.description }} (+{{ rule.points }})
                            </a>
                            {% if rule.details %}
                                <span class="tooltip-text" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ rule.details }}">?</span>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
            <div class="rules-column">
                <h3>Negative Rules</h3>
                <ul>
                    {% for rule in rules if rule.points < 0 %}
                        <li>
                            <a href="#" class="rule-link quick-adjust-link" data-points="{{ rule.points }}" data-reason="{{ rule.description }}" data-employee="">
                                {{ rule.description }} ({{ rule.points }})
                            </a>
                            {% if rule.details %}
                                <span class="tooltip-text" data-bs-toggle="tooltip" data-bs-placement="top" title="{{ rule.details }}">?</span>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
{% endblock %}