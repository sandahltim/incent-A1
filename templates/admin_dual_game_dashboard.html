{% extends "base.html" %}
{% block head %}
<style>
/* Admin Dual Game Dashboard Styles */
.admin-dual-dashboard {
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    min-height: 100vh;
    color: #fff;
    font-family: 'Orbitron', monospace;
}

.admin-header {
    background: linear-gradient(90deg, #0f3460 0%, #e94560 50%, #0f3460 100%);
    padding: 20px 0;
    text-align: center;
    box-shadow: 0 4px 20px rgba(233, 69, 96, 0.3);
    margin-bottom: 30px;
}

.admin-title {
    font-size: 2.2rem;
    font-weight: 900;
    text-shadow: 3px 3px 6px rgba(0,0,0,0.5);
    margin: 0;
}

.admin-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: linear-gradient(145deg, #16213e, #0f3460);
    border: 2px solid #e94560;
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    transition: all 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(233, 69, 96, 0.3);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: bold;
    color: #e94560;
    margin-bottom: 10px;
}

.stat-label {
    font-size: 1rem;
    color: #bbb;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.admin-sections {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.admin-section {
    background: linear-gradient(145deg, #16213e, #0f3460);
    border: 2px solid #e94560;
    border-radius: 15px;
    padding: 25px;
}

.section-title {
    font-size: 1.5rem;
    color: #e94560;
    margin-bottom: 20px;
    text-align: center;
    border-bottom: 2px solid #e94560;
    padding-bottom: 10px;
}

.config-form {
    display: grid;
    gap: 15px;
}

.form-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.form-group label {
    font-weight: bold;
    color: #fff;
}

.form-control {
    background: rgba(255, 255, 255, 0.1);
    border: 2px solid #e94560;
    border-radius: 8px;
    padding: 10px 15px;
    color: #fff;
    font-size: 1rem;
}

.form-control:focus {
    outline: none;
    border-color: #ff6b96;
    box-shadow: 0 0 10px rgba(233, 69, 96, 0.3);
}

.admin-btn {
    background: linear-gradient(45deg, #e94560, #ff6b96);
    border: none;
    color: #fff;
    padding: 12px 25px;
    font-size: 1rem;
    font-weight: bold;
    border-radius: 25px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.admin-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(233, 69, 96, 0.4);
}

.admin-btn.danger {
    background: linear-gradient(45deg, #dc143c, #ff4757);
}

.admin-btn.success {
    background: linear-gradient(45deg, #32cd32, #7bed9f);
}

.admin-btn.warning {
    background: linear-gradient(45deg, #ffa500, #ffb347);
    color: #1a1a1a;
}

.employee-list {
    max-height: 400px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 15px;
}

.employee-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 15px;
    margin: 5px 0;
    background: rgba(233, 69, 96, 0.1);
    border-radius: 8px;
    border-left: 4px solid #e94560;
}

.employee-info {
    flex-grow: 1;
}

.employee-name {
    font-weight: bold;
    color: #fff;
}

.employee-stats {
    font-size: 0.9rem;
    color: #bbb;
    margin-top: 5px;
}

.employee-actions {
    display: flex;
    gap: 10px;
}

.mini-btn {
    padding: 5px 12px;
    font-size: 0.8rem;
    border-radius: 15px;
}

.game-management {
    grid-column: 1 / -1;
    margin-top: 20px;
}

.game-tabs {
    display: flex;
    margin-bottom: 20px;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 5px;
}

.game-tab {
    flex: 1;
    padding: 12px 20px;
    background: transparent;
    border: none;
    color: #bbb;
    cursor: pointer;
    border-radius: 8px;
    transition: all 0.3s ease;
    font-weight: bold;
}

.game-tab.active {
    background: #e94560;
    color: #fff;
}

.game-content {
    display: none;
}

.game-content.active {
    display: block;
}

.game-list {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 20px;
}

.game-card {
    background: linear-gradient(145deg, #0f3460, #16213e);
    border: 2px solid #e94560;
    border-radius: 15px;
    padding: 20px;
    transition: all 0.3s ease;
}

.game-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 25px rgba(233, 69, 96, 0.3);
}

.game-name {
    font-size: 1.3rem;
    font-weight: bold;
    color: #e94560;
    margin-bottom: 10px;
}

.game-details {
    font-size: 0.9rem;
    color: #bbb;
    margin-bottom: 15px;
}

.game-actions {
    display: flex;
    gap: 10px;
    justify-content: center;
}

.activity-log {
    max-height: 300px;
    overflow-y: auto;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 15px;
}

.log-item {
    padding: 8px 12px;
    margin: 5px 0;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 6px;
    border-left: 3px solid #e94560;
    font-size: 0.9rem;
}

.log-time {
    color: #888;
    font-size: 0.8rem;
}

.system-alerts {
    background: rgba(255, 193, 7, 0.1);
    border: 2px solid #ffc107;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 20px;
}

.alert-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 193, 7, 0.2);
}

.alert-icon {
    font-size: 1.2rem;
}

.alert-high { color: #dc3545; }
.alert-medium { color: #ffc107; }
.alert-low { color: #28a745; }

/* Charts and Analytics */
.chart-container {
    background: rgba(0, 0, 0, 0.3);
    border-radius: 10px;
    padding: 20px;
    margin: 20px 0;
    position: relative;
    height: 300px;
}

.chart-placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #666;
    font-size: 1.1rem;
}

/* Responsive Design */
@media (max-width: 1200px) {
    .admin-sections {
        grid-template-columns: 1fr;
    }
}

@media (max-width: 768px) {
    .admin-stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }
    
    .game-tabs {
        flex-direction: column;
    }
    
    .game-list {
        grid-template-columns: 1fr;
    }
    
    .employee-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    
    .employee-actions {
        width: 100%;
        justify-content: center;
    }
}

.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    display: none;
}

.loading-spinner {
    border: 4px solid rgba(233, 69, 96, 0.3);
    border-radius: 50%;
    border-top: 4px solid #e94560;
    width: 60px;
    height: 60px;
    animation: spin 1s linear infinite;
}
</style>
{% endblock %}

{% block content %}
<div class="admin-dual-dashboard">
    <div class="admin-header">
        <h1 class="admin-title">üéÆ Dual Game System Administration üéÆ</h1>
        <p class="lead mb-0">Monitor, Configure & Manage Casino Operations</p>
    </div>

    <div class="container-fluid">
        <!-- System Alerts -->
        <div class="system-alerts" id="systemAlerts">
            <h5 class="mb-3">‚ö†Ô∏è System Alerts</h5>
            <div id="alertsList">
                <!-- Alerts will be loaded here -->
            </div>
        </div>

        <!-- Key Statistics -->
        <div class="admin-stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="totalPlayers">Loading...</div>
                <div class="stat-label">Active Players</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalGamesPlayed">Loading...</div>
                <div class="stat-label">Games Played Today</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalTokensInPlay">Loading...</div>
                <div class="stat-label">Tokens in Circulation</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="systemRevenue">Loading...</div>
                <div class="stat-label">System Revenue</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="categoryAWins">Loading...</div>
                <div class="stat-label">Category A Wins</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="categoryBWins">Loading...</div>
                <div class="stat-label">Category B Wins</div>
            </div>
        </div>

        <!-- Main Admin Sections -->
        <div class="admin-sections">
            <!-- System Configuration -->
            <div class="admin-section">
                <h3 class="section-title">‚öôÔ∏è System Configuration</h3>
                <form class="config-form" id="systemConfigForm">
                    {{ csrf_token() }}
                    <div class="form-group">
                        <label>System Status</label>
                        <select class="form-control" id="systemStatus">
                            <option value="active">Active</option>
                            <option value="maintenance">Maintenance</option>
                            <option value="disabled">Disabled</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Category A Award Rate (%)</label>
                        <input type="number" class="form-control" id="categoryARate" min="0" max="100" value="25">
                    </div>
                    <div class="form-group">
                        <label>Category B House Edge (%)</label>
                        <input type="number" class="form-control" id="categoryBEdge" min="0" max="50" value="5">
                    </div>
                    <div class="form-group">
                        <label>Max Daily Token Exchange</label>
                        <input type="number" class="form-control" id="maxExchange" min="1" value="500">
                    </div>
                    <button type="submit" class="admin-btn">Update Configuration</button>
                </form>
            </div>

            <!-- Player Management -->
            <div class="admin-section">
                <h3 class="section-title">üë• Player Management</h3>
                <div class="mb-3">
                    <input type="text" class="form-control" id="playerSearch" placeholder="Search players...">
                </div>
                <div class="employee-list" id="playerList">
                    <!-- Player list will be loaded here -->
                </div>
                <div class="text-center mt-3">
                    <button class="admin-btn success" onclick="awardCategoryAGames()">Award Category A Games</button>
                </div>
            </div>

            <!-- Token Economy Management -->
            <div class="admin-section">
                <h3 class="section-title">ü™ô Token Economy</h3>
                <div class="config-form">
                    <h5>Exchange Rates by Tier</h5>
                    <div class="form-group">
                        <label>Bronze Tier (Points:Tokens)</label>
                        <input type="number" class="form-control" id="bronzeRate" value="10">
                    </div>
                    <div class="form-group">
                        <label>Silver Tier (Points:Tokens)</label>
                        <input type="number" class="form-control" id="silverRate" value="8">
                    </div>
                    <div class="form-group">
                        <label>Gold Tier (Points:Tokens)</label>
                        <input type="number" class="form-control" id="goldRate" value="6">
                    </div>
                    <div class="form-group">
                        <label>Platinum Tier (Points:Tokens)</label>
                        <input type="number" class="form-control" id="platinumRate" value="5">
                    </div>
                    <button class="admin-btn" onclick="updateExchangeRates()">Update Rates</button>
                </div>
            </div>

            <!-- Activity Monitoring -->
            <div class="admin-section">
                <h3 class="section-title">üìä Activity Monitor</h3>
                <div class="activity-log" id="activityLog">
                    <!-- Activity log will be loaded here -->
                </div>
                <div class="text-center mt-3">
                    <button class="admin-btn" onclick="refreshActivityLog()">Refresh Log</button>
                    <button class="admin-btn warning" onclick="exportActivityLog()">Export Log</button>
                </div>
            </div>
        </div>

        <!-- Game Management -->
        <div class="admin-section game-management">
            <h3 class="section-title">üéÆ Game Management</h3>
            
            <div class="game-tabs">
                <button class="game-tab active" onclick="switchGameTab('categoryA')">Category A Games</button>
                <button class="game-tab" onclick="switchGameTab('categoryB')">Category B Games</button>
                <button class="game-tab" onclick="switchGameTab('analytics')">Game Analytics</button>
            </div>

            <!-- Category A Games -->
            <div class="game-content active" id="categoryAContent">
                <div class="mb-3">
                    <button class="admin-btn success" onclick="createCategoryAGame()">Create New Category A Game</button>
                    <button class="admin-btn" onclick="bulkAwardGames()">Bulk Award Games</button>
                </div>
                <div class="game-list" id="categoryAGames">
                    <!-- Category A games will be loaded here -->
                </div>
            </div>

            <!-- Category B Games -->
            <div class="game-content" id="categoryBContent">
                <div class="mb-3">
                    <button class="admin-btn success" onclick="configureCategoryBGame()">Configure Game Settings</button>
                    <button class="admin-btn warning" onclick="adjustOdds()">Adjust Win Odds</button>
                </div>
                <div class="game-list" id="categoryBGames">
                    <!-- Category B games will be loaded here -->
                </div>
            </div>

            <!-- Game Analytics -->
            <div class="game-content" id="analyticsContent">
                <div class="row">
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5 class="text-center mb-3">Daily Game Activity</h5>
                            <div class="chart-placeholder" id="dailyChart">
                                üìä Daily activity chart would display here
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="chart-container">
                            <h5 class="text-center mb-3">Win/Loss Distribution</h5>
                            <div class="chart-placeholder" id="distributionChart">
                                üìà Win/loss distribution chart would display here
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md-12">
                        <div class="chart-container">
                            <h5 class="text-center mb-3">Token Economy Flow</h5>
                            <div class="chart-placeholder" id="tokenFlowChart">
                                üí∞ Token flow chart would display here
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Controls -->
        <div class="admin-section mt-4">
            <h3 class="section-title">üéõÔ∏è System Controls</h3>
            <div class="row">
                <div class="col-md-3">
                    <button class="admin-btn success w-100 mb-2" onclick="systemAction('backup')">Backup System</button>
                </div>
                <div class="col-md-3">
                    <button class="admin-btn warning w-100 mb-2" onclick="systemAction('maintenance')">Maintenance Mode</button>
                </div>
                <div class="col-md-3">
                    <button class="admin-btn w-100 mb-2" onclick="systemAction('reset_daily')">Reset Daily Stats</button>
                </div>
                <div class="col-md-3">
                    <button class="admin-btn danger w-100 mb-2" onclick="systemAction('emergency_stop')">Emergency Stop</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="text-center text-white">
        <div class="loading-spinner"></div>
        <h4 class="mt-3">Processing...</h4>
    </div>
</div>

<script>
class AdminDualGameDashboard {
    constructor() {
        this.csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
        this.refreshInterval = null;
        this.init();
    }

    async init() {
        await this.loadSystemStats();
        await this.loadSystemAlerts();
        await this.loadPlayerList();
        await this.loadActivityLog();
        await this.loadGameLists();
        this.setupEventListeners();
        this.startAutoRefresh();
    }

    async loadSystemStats() {
        try {
            const response = await fetch('/api/dual_game/metrics');
            const data = await response.json();
            
            if (response.ok) {
                document.getElementById('totalPlayers').textContent = data.active_players || '0';
                document.getElementById('totalGamesPlayed').textContent = data.games_today || '0';
                document.getElementById('totalTokensInPlay').textContent = data.tokens_circulation || '0';
                document.getElementById('systemRevenue').textContent = data.revenue || '$0';
                document.getElementById('categoryAWins').textContent = data.category_a_wins || '0';
                document.getElementById('categoryBWins').textContent = data.category_b_wins || '0';
            }
        } catch (error) {
            console.error('Error loading system stats:', error);
        }
    }

    async loadSystemAlerts() {
        const alertsList = document.getElementById('alertsList');
        
        // Example alerts - would come from your API
        const alerts = [
            { level: 'high', message: 'Token circulation exceeding daily limit', time: '2 minutes ago' },
            { level: 'medium', message: 'Category A games running low for Silver tier', time: '15 minutes ago' },
            { level: 'low', message: 'Daily backup completed successfully', time: '1 hour ago' }
        ];

        alertsList.innerHTML = alerts.map(alert => `
            <div class="alert-item">
                <span class="alert-icon alert-${alert.level}">
                    ${alert.level === 'high' ? 'üö®' : alert.level === 'medium' ? '‚ö†Ô∏è' : '‚úÖ'}
                </span>
                <div class="flex-grow-1">
                    <div>${alert.message}</div>
                    <div class="log-time">${alert.time}</div>
                </div>
            </div>
        `).join('');
    }

    async loadPlayerList() {
        try {
            // This would connect to your employee API
            const playerList = document.getElementById('playerList');
            
            // Example player data
            const players = [
                { id: 'E001', name: 'John Doe', tier: 'Gold', tokens: 150, points: 2500, games_played: 12 },
                { id: 'E002', name: 'Jane Smith', tier: 'Platinum', tokens: 300, points: 5000, games_played: 25 },
                { id: 'E003', name: 'Bob Johnson', tier: 'Silver', tokens: 75, points: 1200, games_played: 8 }
            ];

            playerList.innerHTML = players.map(player => `
                <div class="employee-item">
                    <div class="employee-info">
                        <div class="employee-name">${player.name} (${player.id})</div>
                        <div class="employee-stats">
                            ${player.tier} | ${player.tokens} Tokens | ${player.points} Points | ${player.games_played} Games
                        </div>
                    </div>
                    <div class="employee-actions">
                        <button class="admin-btn mini-btn" onclick="adminDashboard.viewPlayer('${player.id}')">View</button>
                        <button class="admin-btn mini-btn success" onclick="adminDashboard.awardPlayer('${player.id}')">Award</button>
                        <button class="admin-btn mini-btn warning" onclick="adminDashboard.adjustPlayer('${player.id}')">Adjust</button>
                    </div>
                </div>
            `).join('');
        } catch (error) {
            console.error('Error loading player list:', error);
        }
    }

    async loadActivityLog() {
        const activityLog = document.getElementById('activityLog');
        
        // Example activity data
        const activities = [
            { action: 'Player E001 won Category B Slots', amount: '+50 tokens', time: '1 minute ago' },
            { action: 'Player E002 exchanged points for tokens', amount: '100 points ‚Üí 20 tokens', time: '3 minutes ago' },
            { action: 'Category A game awarded to E003', amount: '+200 points', time: '5 minutes ago' },
            { action: 'System backup completed', amount: 'Success', time: '1 hour ago' },
            { action: 'Daily statistics reset', amount: 'Completed', time: '6 hours ago' }
        ];

        activityLog.innerHTML = activities.map(activity => `
            <div class="log-item">
                <div>${activity.action}</div>
                <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                    <span style="color: #e94560; font-weight: bold;">${activity.amount}</span>
                    <span class="log-time">${activity.time}</span>
                </div>
            </div>
        `).join('');
    }

    async loadGameLists() {
        await this.loadCategoryAGames();
        await this.loadCategoryBGames();
    }

    async loadCategoryAGames() {
        const gamesList = document.getElementById('categoryAGames');
        
        // Example Category A games
        const games = [
            { id: 1, name: 'Lucky Slots', description: 'Guaranteed points prize', status: 'Active', awarded_count: 15 },
            { id: 2, name: 'Prize Wheel', description: 'PTO hours or swag items', status: 'Active', awarded_count: 8 },
            { id: 3, name: 'Treasure Box', description: 'Mystery rewards', status: 'Paused', awarded_count: 22 }
        ];

        gamesList.innerHTML = games.map(game => `
            <div class="game-card">
                <div class="game-name">${game.name}</div>
                <div class="game-details">
                    ${game.description}<br>
                    Status: <strong>${game.status}</strong><br>
                    Awarded: <strong>${game.awarded_count} times</strong>
                </div>
                <div class="game-actions">
                    <button class="admin-btn mini-btn" onclick="adminDashboard.editGame('A', ${game.id})">Edit</button>
                    <button class="admin-btn mini-btn ${game.status === 'Active' ? 'warning' : 'success'}" 
                            onclick="adminDashboard.toggleGame('A', ${game.id})">
                        ${game.status === 'Active' ? 'Pause' : 'Activate'}
                    </button>
                </div>
            </div>
        `).join('');
    }

    async loadCategoryBGames() {
        const gamesList = document.getElementById('categoryBGames');
        
        // Example Category B games
        const games = [
            { id: 1, name: 'Slot Machine', win_rate: '35%', house_edge: '5%', plays_today: 45 },
            { id: 2, name: 'Dice Game', win_rate: '30%', house_edge: '6%', plays_today: 32 },
            { id: 3, name: 'Wheel of Fortune', win_rate: '25%', house_edge: '7%', plays_today: 28 },
            { id: 4, name: 'Blackjack', win_rate: '40%', house_edge: '4%', plays_today: 18 }
        ];

        gamesList.innerHTML = games.map(game => `
            <div class="game-card">
                <div class="game-name">${game.name}</div>
                <div class="game-details">
                    Win Rate: <strong>${game.win_rate}</strong><br>
                    House Edge: <strong>${game.house_edge}</strong><br>
                    Plays Today: <strong>${game.plays_today}</strong>
                </div>
                <div class="game-actions">
                    <button class="admin-btn mini-btn" onclick="adminDashboard.configureGame('B', ${game.id})">Configure</button>
                    <button class="admin-btn mini-btn warning" onclick="adminDashboard.adjustOdds('B', ${game.id})">Adjust Odds</button>
                </div>
            </div>
        `).join('');
    }

    setupEventListeners() {
        // System configuration form
        document.getElementById('systemConfigForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            await this.updateSystemConfig();
        });

        // Player search
        document.getElementById('playerSearch').addEventListener('input', (e) => {
            this.filterPlayers(e.target.value);
        });
    }

    async updateSystemConfig() {
        this.showLoading(true);
        
        try {
            const formData = {
                system_status: document.getElementById('systemStatus').value,
                category_a_rate: document.getElementById('categoryARate').value,
                category_b_edge: document.getElementById('categoryBEdge').value,
                max_exchange: document.getElementById('maxExchange').value
            };

            const response = await fetch('/api/dual_game/config/update', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': this.csrfToken
                },
                body: JSON.stringify(formData)
            });

            const result = await response.json();
            
            if (response.ok) {
                this.showSuccess('System configuration updated successfully');
            } else {
                this.showError(result.error || 'Configuration update failed');
            }
        } catch (error) {
            console.error('Error updating configuration:', error);
            this.showError('Configuration update failed');
        } finally {
            this.showLoading(false);
        }
    }

    filterPlayers(searchTerm) {
        const playerItems = document.querySelectorAll('.employee-item');
        playerItems.forEach(item => {
            const playerName = item.querySelector('.employee-name').textContent.toLowerCase();
            if (playerName.includes(searchTerm.toLowerCase())) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    }

    switchGameTab(tab) {
        // Update tab buttons
        document.querySelectorAll('.game-tab').forEach(btn => btn.classList.remove('active'));
        event.target.classList.add('active');

        // Update content
        document.querySelectorAll('.game-content').forEach(content => content.classList.remove('active'));
        document.getElementById(tab + 'Content').classList.add('active');
    }

    startAutoRefresh() {
        this.refreshInterval = setInterval(() => {
            this.loadSystemStats();
            this.loadActivityLog();
        }, 30000); // Refresh every 30 seconds
    }

    viewPlayer(playerId) {
        // Implement player detail view
        this.showInfo(`Viewing details for player ${playerId}`);
    }

    awardPlayer(playerId) {
        // Implement award player functionality
        this.showInfo(`Awarding Category A game to player ${playerId}`);
    }

    adjustPlayer(playerId) {
        // Implement player adjustment functionality
        this.showInfo(`Adjusting settings for player ${playerId}`);
    }

    editGame(category, gameId) {
        this.showInfo(`Editing Category ${category} game ${gameId}`);
    }

    toggleGame(category, gameId) {
        this.showInfo(`Toggling Category ${category} game ${gameId}`);
    }

    configureGame(category, gameId) {
        this.showInfo(`Configuring Category ${category} game ${gameId}`);
    }

    adjustOdds(category, gameId) {
        this.showInfo(`Adjusting odds for Category ${category} game ${gameId}`);
    }

    async systemAction(action) {
        if (action === 'emergency_stop' && !confirm('Are you sure you want to emergency stop the system?')) {
            return;
        }

        this.showLoading(true);
        
        try {
            // Implement system action API calls
            this.showSuccess(`System action "${action}" completed successfully`);
        } catch (error) {
            this.showError(`System action "${action}" failed`);
        } finally {
            this.showLoading(false);
        }
    }

    refreshActivityLog() {
        this.loadActivityLog();
    }

    exportActivityLog() {
        this.showInfo('Exporting activity log...');
    }

    showLoading(show) {
        document.getElementById('loadingOverlay').style.display = show ? 'flex' : 'none';
    }

    showSuccess(message) {
        this.showToast(message, 'success');
    }

    showError(message) {
        this.showToast(message, 'danger');
    }

    showInfo(message) {
        this.showToast(message, 'info');
    }

    showToast(message, type) {
        const toast = document.createElement('div');
        toast.className = `alert alert-${type} fade show position-fixed`;
        toast.style = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
        toast.innerHTML = `
            ${message}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        `;
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 5000);
    }
}

// Global functions
let adminDashboard;

function switchGameTab(tab) {
    adminDashboard.switchGameTab(tab);
}

function awardCategoryAGames() {
    adminDashboard.showInfo('Bulk awarding Category A games to eligible players...');
}

function createCategoryAGame() {
    adminDashboard.showInfo('Creating new Category A game...');
}

function bulkAwardGames() {
    adminDashboard.showInfo('Bulk awarding games to selected players...');
}

function configureCategoryBGame() {
    adminDashboard.showInfo('Configuring Category B game settings...');
}

function adjustOdds() {
    adminDashboard.showInfo('Adjusting Category B win odds...');
}

function updateExchangeRates() {
    adminDashboard.showInfo('Updating token exchange rates...');
}

function systemAction(action) {
    adminDashboard.systemAction(action);
}

// Initialize admin dashboard
document.addEventListener('DOMContentLoaded', function() {
    adminDashboard = new AdminDualGameDashboard();
});
</script>
{% endblock %}