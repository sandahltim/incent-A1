let lastConfettiTime=0;const MIN_CONFETTI_INTERVAL=500;let activeConfettiCount=0;const MAX_ACTIVE_CONFETTI=150;function confetti(opts={}){const now=Date.now();if(now-lastConfettiTime<MIN_CONFETTI_INTERVAL){return;}const defaults={particleCount:30,spread:70,origin:{y:0.6}};const options={...defaults,...opts};if(activeConfettiCount>=MAX_ACTIVE_CONFETTI){return;}lastConfettiTime=now;for(let i=0;i<options.particleCount;i++){setTimeout(()=>{createConfettiPiece(options.origin,options.spread);},i*20);}}
function createConfettiPiece(origin,spread){if(activeConfettiCount>=MAX_ACTIVE_CONFETTI){return;}activeConfettiCount++;const confetti=document.createElement('div');confetti.className='confetti-particle';confetti.style.cssText=`position:fixed;width:8px;height:8px;background:${getRandomColor()};pointer-events:none;z-index:10000;border-radius:50%;`;const centerX=(origin.x||0.5)*window.innerWidth;const centerY=(origin.y||0.5)*window.innerHeight;const angle=(Math.random()-0.5)*spread*(Math.PI/180);const velocity=80+Math.random()*120;const vx=Math.cos(angle)*velocity;const vy=Math.sin(angle)*velocity-Math.random()*80;confetti.style.left=centerX+'px';confetti.style.top=centerY+'px';document.body.appendChild(confetti);let posX=0;let posY=0;let velX=vx;let velY=vy;let gravity=600;let animationFrames=0;const maxFrames=150;const animate=()=>{if(animationFrames>=maxFrames){confetti.remove();activeConfettiCount--;return;}const dt=0.016;velY+=gravity*dt;posX+=velX*dt;posY+=velY*dt;animationFrames++;confetti.style.transform=`translate3d(${posX}px,${posY}px,0)rotate(${posX}deg)`;confetti.style.opacity=Math.max(0,1-(posY/window.innerHeight));if(posY<window.innerHeight&&confetti.style.opacity>0.1){requestAnimationFrame(animate);}else{confetti.remove();activeConfettiCount--;}};requestAnimationFrame(animate);}
function getRandomColor(){const colors=['#FFD700','#FF6B6B','#4ECDC4','#45B7D1','#96CEB4','#FFA500'];return colors[Math.floor(Math.random()*colors.length)];}
function getConfettiStats(){return{activeCount:activeConfettiCount,maxCount:MAX_ACTIVE_CONFETTI,lastTriggerTime:lastConfettiTime,throttleInterval:MIN_CONFETTI_INTERVAL};}
function clearAllConfetti(){const particles=document.querySelectorAll('.confetti-particle');particles.forEach(particle=>particle.remove());activeConfettiCount=0;}
window.confetti=confetti;window.getConfettiStats=getConfettiStats;window.clearAllConfetti=clearAllConfetti;